<h1>All Projects</h1>
<p><%= link_to "home", root_path %> | <%= link_to "Edit Schedule", schedules_path %> | <%= link_to "View Calendar", calendar_schedules_path %> </p>
Time Span:
<%= form_tag(projects_path, method: :get) do %>
	Start:<br> <%= select_date @start_date, {:prefix => 'start_date'}, {:class => "input-small"} %><br>
	Finish:<br> <%= select_date @end_date, {:prefix => 'end_date'}, {:class => "input-small"} %><br>
<%= submit_tag %>
<% end %>
<% total_project_time=0 %>
<table class="table-striped">
<tr>
<td style="text-align:center">Project</td>
<td style="text-align:center">Hours Spent</td>
<td style="text-align:center">Modify</td>
</tr>
<% @projects.each do |project| %>
	<% total_time = 0 %>
	<% project.schedules.each do |s| %>
		<% start = s.start_at %>
		<% finish = s.end_at.blank? ? 5.hours.ago : s.end_at %>
		<% if (@start_date.to_datetime < finish && finish < (@end_date.to_datetime+1.day)) && (@start_date.to_datetime < start && start < (@end_date.to_datetime+1.day)) %>
		<% elsif (@start_date.to_datetime < finish && finish < (@end_date.to_datetime+1.day)) %>
			<% start = @start_date.to_datetime %>
		<% elsif (@start_date.to_datetime < start && start < (@end_date.to_datetime+1.day)) %>
			<% finish = @end_date.to_datetime+1.day %>
		<% else %>
			<% start = @start_date %>
			<% finish = @start_date %>
		<% end %>
		<% total_time = total_time + (finish - start) %>
	<% end %>
	<% total_project_time = total_project_time+total_time %>
<tr>
	<td style="text-align:left"><%= link_to project.name, project_path(project) %> </td>
	<td style="text-align:center"><%= ((2*total_time/60/60).ceil)/2.0 %></td>
	<td style="text-align:center"><%= link_to 'Edit', edit_project_path(project) %> | <%= link_to "delete", project, :method => :delete, :confirm => "You sure?",:title => "Delete #{project.name}" %></td>
</tr>
<% end %>
</table>
<%= ((2*total_project_time/60/60).ceil)/2.0 %>
<%= link_to 'New Project', new_project_path %>
