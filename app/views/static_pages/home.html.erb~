<h1>Time Saver</h1>
<%= link_to "Edit Schedule", schedules_path %> | <%= link_to "View Calendar", calendar_schedules_path %>
<table>
<tr>
<%= form_tag(new_schedule_path, class: "form-inline", :style => "display:inline", method: :get) do %>
  <td style="text-align:left;vertical-align:center"><%= text_field_tag :name, "", data: {autocomplete_source: autocomplete_projects_path}, placeholder: "Project", class: "autocomplete", :style => "display:inline;margin:0" %></td>
  <td style="text-align:center;vertical-align:center">
  <button class="btn btn-success" name="go" type="submit">
  	<i class="icon-play icon-white"></i>
	</button>
<% end %>
</tr>

<% Project.all.sort_by(&:name).each do |project| %>
	<% if project.featured %>
	<tr>
		<td style="text-align:left"><%= link_to project.name, project_path(project) %></td>
		<td style="text-align:center;vertical-align:center">
		<%= form_tag(new_schedule_path, class: "form-inline", :style => "display:inline", method: :get) do %>
			<%= hidden_field_tag :name, project.name  %>
			<% if project.active? %>
				<button class="btn btn-danger" name="stop" type="submit">
					<i class="icon-pause icon-white"></i>
				</button>
			<% else %>
				<button class="btn btn-success" name="go" type="submit">
					<i class="icon-play icon-white"></i>
				</button>
			<% end %>	
		
		</td>
		<td>
			<button class="btn btn-danger" name="del" type="submit">
					<i class="icon-remove icon-white"></i>
			</button>
			</td>
	</tr>
	<% end %>
	<% end %>
<% end %>
</table>
<p>
<%= link_to "Edit Schedule", schedules_path %> | <%= link_to "View Calendar", calendar_schedules_path %>
</p>
<% total_time = 0 %>
<% begday = 5.hours.ago.beginning_of_day %>
<% endday = 5.hours.ago.end_of_day %>
<% Project.all.each do |project| %>
<% project.schedules.each do |s| %>
	<% start = s.start_at %>
	<% finish = s.end_at.blank? ? 5.hours.ago : s.end_at %>
	<% if  begday < finish && finish < endday && begday < start && start < endday %>
	<% elsif begday < finish && finish < endday %>
		<% start = begday %>
	<% elsif begday < start && start < endday %>
		<% finish = endday %>
	<% else %>
		<% start = begday %>
		<% finish = begday %>
	<% end %>
	<% total_time = total_time + (finish - start) %>
<% end %>
<% end %>
<p><%= (total_time/3600).round(1) %> hours worked today</p>

