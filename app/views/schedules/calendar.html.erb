<div id='calendar'></div>
<script>
$(function() {
  $('#calendar').fullCalendar({
    height: 600,
    theme: false,
    firstHour: 8,
    allDaySlot: false,
    defaultView: 'agendaWeek',
		slotMinutes: 30,
    snapMinutes: 5,
    editable: true,
		selectable: true,
    header: {
			left: 'prev,next today',
			center: 'title',
			right: 'month,agendaWeek,agendaDay'
		},
		eventClick: function(event, jsEvent, view) {
			$.ajax({
				type:"GET",
				url: "/schedules/" + event.id + "/pop_up.js"
			});
    },
		eventResize: function(event,dayDelta,minuteDelta,allDay,revertFunc) {
			$.ajax({
				type:"GET",
				url: "/schedules/" + event.id + "/calendar_update/",
				data: "minute_delta="+minuteDelta+"&day_delta="+dayDelta+"&method=resize"
			});
		},
		eventDrop: function(event,dayDelta,minuteDelta,allDay,revertFunc) {
			$.ajax({
				type:"GET",
				url: "/schedules/" + event.id + "/calendar_update/",
				data: "minute_delta="+minuteDelta+"&day_delta="+dayDelta+"&method=drop"
			});
		},
		events: [
		<% Schedule.where(user_id: current_user.id).sort_by(&:id).each do |event| %>
			<% if event.duration > 60 && !event.project.blank? %>
			{
				title: '<%= event.project.name %>',
				id: '<%= event.id %>',
				selectable: true,
				start: new Date(<%= event.start_at.year %>, <%= event.start_at.month-1 %>, <%= event.start_at.day %>, <%= event.start_at.hour %>, <%= event.start_at.min %>),
				<% if event.end_at %>
					end: new Date(<%= event.end_at.year %>, <%= event.end_at.month-1 %>, <%= event.end_at.day %>, <%= event.end_at.hour %>, <%= event.end_at.min %>),
				<% else %>
					end: new Date(<%= 0.hours.ago.year %>, <%= 0.hours.ago.month-1 %>, <%= 0.hours.ago.day %>, <%= 0.hours.ago.hour %>, <%= 0.hours.ago.min %>),
				<% end %>
				allDay: false
			}<%= "," if event != Schedule.last %>
			<% end %>
		<% end %>
		]})
    
});
</script>




<div class="modal fade bs-example-modal-sm" id="Schedule" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="SettingsLabel">Update Project</h4></div>
                <div class="modal-body" style="text-align:center">
<% if current_user %>
	<%= form_for(resource, as: resource_name, url: password_path(resource_name), html: { method: :put }) do |f| %>
		<%= devise_error_messages! %>

		<%= f.hidden_field :reset_password_token %>

		<div class="form-group">
			<%= f.label :password, "New password" %>
			<%= f.password_field :password, autofocus: true, autocomplete: "off", class: "form-control" %></div>

		<div class="form-group">
			<%= f.label :password_confirmation, "Confirm new password" %>
			<%= f.password_field :password_confirmation, autocomplete: "off", class: "form-control" %></div>
		<div class="modal-footer">

		<%= f.submit "Save changes", class: "btn btn-default" %>
		<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		</div>
	<% end %>
<% end %>  
		</div>
    </div>
  </div>
</div>
